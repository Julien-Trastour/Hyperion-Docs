"use strict";(self.webpackChunkhyperion_docs=self.webpackChunkhyperion_docs||[]).push([[6817],{7564:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"kronos/database/schema","title":"\ud83d\udccc Sch\xe9ma de la Base de Donn\xe9es - Kronos","description":"\ud83d\ude80 Objectif","source":"@site/docs/kronos/database/schema.md","sourceDirName":"kronos/database","slug":"/kronos/database/schema","permalink":"/hyperion-docs/docs/kronos/database/schema","draft":false,"unlisted":false,"editUrl":"https://github.com/Julien-Trastour/Hyperion-Docs.git/edit/main/docs/kronos/database/schema.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"\ud83d\udccc Database - Stockage Centralis\xe9 pour Kronos","permalink":"/hyperion-docs/docs/kronos/database/"},"next":{"title":"deployment","permalink":"/hyperion-docs/docs/kronos/deployment"}}');var t=n(4848),i=n(8453);const o={},a="\ud83d\udccc Sch\xe9ma de la Base de Donn\xe9es - Kronos",d={},c=[{value:"\ud83d\ude80 Objectif",id:"-objectif",level:2},{value:"\ud83d\udcc2 Tables par Microservice",id:"-tables-par-microservice",level:2},{value:"1\ufe0f\u20e3 <strong><code>auth-service</code></strong> <em>(Gestion de l\u2019authentification et des tokens)</em>",id:"1\ufe0f\u20e3-auth-service-gestion-de-lauthentification-et-des-tokens",level:3},{value:"2\ufe0f\u20e3 <strong><code>user-service</code></strong> <em>(Gestion des utilisateurs et des r\xf4les)</em>",id:"2\ufe0f\u20e3-user-service-gestion-des-utilisateurs-et-des-r\xf4les",level:3},{value:"3\ufe0f\u20e3 <strong><code>log-service</code></strong> <em>(Stockage des logs pour Gaia)</em>",id:"3\ufe0f\u20e3-log-service-stockage-des-logs-pour-gaia",level:3},{value:"4\ufe0f\u20e3 <strong><code>cache-service</code></strong> <em>(Stockage temporaire des donn\xe9es)</em>",id:"4\ufe0f\u20e3-cache-service-stockage-temporaire-des-donn\xe9es",level:3},{value:"5\ufe0f\u20e3 <strong><code>router-service</code></strong> <em>(Gestion des routes API et des quotas d\u2019acc\xe8s)</em>",id:"5\ufe0f\u20e3-router-service-gestion-des-routes-api-et-des-quotas-dacc\xe8s",level:3},{value:"6\ufe0f\u20e3 <strong><code>messaging-service</code></strong> <em>(Gestion des files d\u2019attente Kafka/RabbitMQ)</em>",id:"6\ufe0f\u20e3-messaging-service-gestion-des-files-dattente-kafkarabbitmq",level:3},{value:"7\ufe0f\u20e3 <strong><code>database</code></strong> <em>(Stockage des backups et requ\xeates internes)</em>",id:"7\ufe0f\u20e3-database-stockage-des-backups-et-requ\xeates-internes",level:3},{value:"\ud83d\udd17 Relations et Contraintes",id:"-relations-et-contraintes",level:2},{value:"\ud83d\ude80 Optimisation et S\xe9curit\xe9",id:"-optimisation-et-s\xe9curit\xe9",level:2}];function l(e){const s={br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"-sch\xe9ma-de-la-base-de-donn\xe9es---kronos",children:"\ud83d\udccc Sch\xe9ma de la Base de Donn\xe9es - Kronos"})}),"\n",(0,t.jsx)(s.h2,{id:"-objectif",children:"\ud83d\ude80 Objectif"}),"\n",(0,t.jsxs)(s.p,{children:["Le sch\xe9ma relationnel de ",(0,t.jsx)(s.code,{children:"database"})," d\xe9finit la structure des donn\xe9es utilis\xe9es par ",(0,t.jsx)(s.strong,{children:"tous les sous-microservices de Kronos"}),". Il garantit ",(0,t.jsx)(s.strong,{children:"l\u2019int\xe9grit\xe9, la performance et la s\xe9curit\xe9"})," des informations stock\xe9es."]}),"\n",(0,t.jsx)(s.h2,{id:"-tables-par-microservice",children:"\ud83d\udcc2 Tables par Microservice"}),"\n",(0,t.jsxs)(s.h3,{id:"1\ufe0f\u20e3-auth-service-gestion-de-lauthentification-et-des-tokens",children:["1\ufe0f\u20e3 ",(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"auth-service"})})," ",(0,t.jsx)(s.em,{children:"(Gestion de l\u2019authentification et des tokens)"})]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sql",children:"CREATE TABLE sessions (\n    id SERIAL PRIMARY KEY,\n    user_id INT REFERENCES users(id),\n    token TEXT NOT NULL,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    expires_at TIMESTAMP\n);\n"})}),"\n",(0,t.jsxs)(s.p,{children:["\u2705 ",(0,t.jsx)(s.strong,{children:"Stocke les sessions utilisateurs"})," (JWT, OAuth, expiration)."]}),"\n",(0,t.jsxs)(s.h3,{id:"2\ufe0f\u20e3-user-service-gestion-des-utilisateurs-et-des-r\xf4les",children:["2\ufe0f\u20e3 ",(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"user-service"})})," ",(0,t.jsx)(s.em,{children:"(Gestion des utilisateurs et des r\xf4les)"})]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sql",children:"CREATE TABLE users (\n    id SERIAL PRIMARY KEY,\n    username VARCHAR(255) UNIQUE NOT NULL,\n    email VARCHAR(255) UNIQUE NOT NULL,\n    password_hash TEXT NOT NULL,\n    role_id INT REFERENCES roles(id),\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE TABLE roles (\n    id SERIAL PRIMARY KEY,\n    name VARCHAR(100) UNIQUE NOT NULL,\n    permissions TEXT[] NOT NULL\n);\n"})}),"\n",(0,t.jsxs)(s.p,{children:["\u2705 ",(0,t.jsx)(s.strong,{children:"Associe les utilisateurs \xe0 leurs r\xf4les et permissions"}),"."]}),"\n",(0,t.jsxs)(s.h3,{id:"3\ufe0f\u20e3-log-service-stockage-des-logs-pour-gaia",children:["3\ufe0f\u20e3 ",(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"log-service"})})," ",(0,t.jsx)(s.em,{children:"(Stockage des logs pour Gaia)"})]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sql",children:"CREATE TABLE logs (\n    id SERIAL PRIMARY KEY,\n    service_name VARCHAR(255) NOT NULL,\n    level VARCHAR(50) NOT NULL,\n    message TEXT NOT NULL,\n    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n"})}),"\n",(0,t.jsxs)(s.p,{children:["\u2705 ",(0,t.jsx)(s.strong,{children:"Stocke les logs g\xe9n\xe9r\xe9s par les microservices"}),"."]}),"\n",(0,t.jsxs)(s.h3,{id:"4\ufe0f\u20e3-cache-service-stockage-temporaire-des-donn\xe9es",children:["4\ufe0f\u20e3 ",(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"cache-service"})})," ",(0,t.jsx)(s.em,{children:"(Stockage temporaire des donn\xe9es)"})]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sql",children:"CREATE TABLE cache (\n    key VARCHAR(255) PRIMARY KEY,\n    value TEXT NOT NULL,\n    expires_at TIMESTAMP\n);\n"})}),"\n",(0,t.jsxs)(s.p,{children:["\u2705 ",(0,t.jsx)(s.strong,{children:"Permet de stocker des donn\xe9es temporairement"})," (sessions, permissions, etc.)."]}),"\n",(0,t.jsxs)(s.h3,{id:"5\ufe0f\u20e3-router-service-gestion-des-routes-api-et-des-quotas-dacc\xe8s",children:["5\ufe0f\u20e3 ",(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"router-service"})})," ",(0,t.jsx)(s.em,{children:"(Gestion des routes API et des quotas d\u2019acc\xe8s)"})]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sql",children:"CREATE TABLE routes (\n    id SERIAL PRIMARY KEY,\n    path VARCHAR(255) UNIQUE NOT NULL,\n    service VARCHAR(255) NOT NULL,\n    method VARCHAR(10) NOT NULL\n);\n\nCREATE TABLE rate_limits (\n    id SERIAL PRIMARY KEY,\n    user_id INT REFERENCES users(id),\n    route_id INT REFERENCES routes(id),\n    request_count INT DEFAULT 0,\n    last_request TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n"})}),"\n",(0,t.jsxs)(s.p,{children:["\u2705 ",(0,t.jsx)(s.strong,{children:"Permet de limiter l\u2019acc\xe8s \xe0 certaines routes API"}),"."]}),"\n",(0,t.jsxs)(s.h3,{id:"6\ufe0f\u20e3-messaging-service-gestion-des-files-dattente-kafkarabbitmq",children:["6\ufe0f\u20e3 ",(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"messaging-service"})})," ",(0,t.jsx)(s.em,{children:"(Gestion des files d\u2019attente Kafka/RabbitMQ)"})]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sql",children:"CREATE TABLE message_queue (\n    id SERIAL PRIMARY KEY,\n    topic VARCHAR(255) NOT NULL,\n    payload TEXT NOT NULL,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    status VARCHAR(50) DEFAULT 'pending'\n);\n"})}),"\n",(0,t.jsxs)(s.p,{children:["\u2705 ",(0,t.jsx)(s.strong,{children:"Stocke temporairement les messages en attente de traitement"}),"."]}),"\n",(0,t.jsxs)(s.h3,{id:"7\ufe0f\u20e3-database-stockage-des-backups-et-requ\xeates-internes",children:["7\ufe0f\u20e3 ",(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"database"})})," ",(0,t.jsx)(s.em,{children:"(Stockage des backups et requ\xeates internes)"})]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sql",children:"CREATE TABLE backups (\n    id SERIAL PRIMARY KEY,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    file_path TEXT NOT NULL\n);\n"})}),"\n",(0,t.jsxs)(s.p,{children:["\u2705 ",(0,t.jsx)(s.strong,{children:"G\xe8re les sauvegardes automatiques de la base"}),"."]}),"\n",(0,t.jsx)(s.h2,{id:"-relations-et-contraintes",children:"\ud83d\udd17 Relations et Contraintes"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Chaque utilisateur"})," appartient \xe0 un ",(0,t.jsx)(s.strong,{children:"r\xf4le unique"})," (",(0,t.jsx)(s.code,{children:"users.role_id \u2192 roles.id"}),")."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Les permissions sont stock\xe9es sous forme de tableau"})," dans ",(0,t.jsx)(s.code,{children:"roles.permissions"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Les logs sont reli\xe9s aux microservices"})," via ",(0,t.jsx)(s.code,{children:"service_name"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Les sessions expirent automatiquement"})," apr\xe8s un certain d\xe9lai."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Les quotas d\u2019API sont suivis par utilisateur et par route"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsxs)(s.strong,{children:["Les messages non trait\xe9s restent en attente dans ",(0,t.jsx)(s.code,{children:"message_queue"})]}),"."]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"-optimisation-et-s\xe9curit\xe9",children:"\ud83d\ude80 Optimisation et S\xe9curit\xe9"}),"\n",(0,t.jsxs)(s.p,{children:["\u2705 ",(0,t.jsxs)(s.strong,{children:["Indexation des champs fr\xe9quemment recherch\xe9s (",(0,t.jsx)(s.code,{children:"email"}),", ",(0,t.jsx)(s.code,{children:"username"}),", ",(0,t.jsx)(s.code,{children:"service_name"}),")"]}),".",(0,t.jsx)(s.br,{}),"\n","\u2705 ",(0,t.jsx)(s.strong,{children:"Chiffrement des mots de passe avec Argon2"}),".",(0,t.jsx)(s.br,{}),"\n","\u2705 ",(0,t.jsx)(s.strong,{children:"Expiration automatique des sessions inactives"}),".",(0,t.jsx)(s.br,{}),"\n","\u2705 ",(0,t.jsx)(s.strong,{children:"Partitionnement des logs pour am\xe9liorer les performances"}),".",(0,t.jsx)(s.br,{}),"\n","\u2705 ",(0,t.jsx)(s.strong,{children:"Monitoring des requ\xeates lentes et analyse des index SQL"}),"."]}),"\n",(0,t.jsx)(s.hr,{})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>a});var r=n(6540);const t={},i=r.createContext(t);function o(e){const s=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(i.Provider,{value:s},e.children)}}}]);